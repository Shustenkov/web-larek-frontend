# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```ts
export interface IProduct {
  category: string;
  description: string;
  id: string;
  image: string;
  price: number;
  title: string;
}
```

Корзина

```ts
export interface ICart {
  items: IProduct[];
  totalPrice: number;
  paymethod: TPaymethod;
  shippingAddress: string;
  email: string;
  phone: string;
  payStatus: boolean;
}
```

Способы оплаты

```ts
export type TPaymethod = 'online' | 'reception';
```

Данные об оплате и доставке

```ts
export type TPurchaseInfo = Pick<ICart, 'paymethod' | 'shippingAddress'>;
```

Контактные данные клиента

```ts
export type TClientInfo = Pick<ICart, 'email' | 'phone'>;
```

## Архитектура приложения

Код приложения разделён на слои согласно парадигме MVP:
- слой представления (View), отвечает за отображение данных на странице
- слой данных (Model), отвечает за хранение и изменение данных
- представитель (Presenter), отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - установить обработчик на событие
- `off` - снять обработчик с события
- `emit` - инициировать событие с данными
- `onAll` - слушать все события
- `offAll` - сбросить все обработчики
- `trigger` - сделать коллбэк триггер, генерирующий событие при вызове

### Слой данных

#### Класс ProductData
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса харнятся следующие данные:
- `_products: IProduct[]` - массив объектов товаров
- `_preview: string | null` - id товара, выбранного для просмотра в модальном окне
- `events: IEvents` - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `addProduct(product: IProduct): void` - добавляет один товар в начало массива и вызывает событие изменения массива
- `removeProduct(id: string, payload: Function | null): void` - удаляет товар из массива. Если передан колбэк, то выполняет его после удаления, если нет, то вызывает событие изменения массива
- `updateProduct(product: IProduct, payload: Function | null): void` - обновляет данные товара в массиве. Если передан колбэк, то выполняет его после обновления, если нет, то вызывает событие изменения массива.
- `getProduct(id: string): IProduct` - возвращает товар по id
- а также сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс CartData
Класс отвечает за хранение и логику работы с данными корзины.\
Конструктор класса принимает инстант брокера событий.\
В полях класса харнятся следующие данные:
- `_items: IProduct[]` - массив объектов товаров в корзине
- `_totalPrice: number` - суммарная стоимость товаров в корзине
- `paymethod: TPaymethod` - способ оплаты
- `shippingAddress: string` - адрес доставки
- `email: string` - email клиента
- `phone: string` - номер телефона клиента
- `payStatus: boolean` - итоговый статус заказа
- `events: IEvents` - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `addItem(item: IProduct): void` - добавляет один товар в конец массива и вызывает событие изменения массива
- `removeItem(id: string, payload: Function | null): void` - удаляет товар из массива. Если передан колбэк, то выполняет его после удаления, если нет, то вызывает событие изменения массива
- `clear(): void` - удаляет все товары из корзины
- `getItem(id: string): IProduct` - возвращает товар по id
- `getPurchaseInfo(): TPurchaseInfo` - возвращает данные о покупке
- `setPurchaseInfo(data: TPurchaseInfo): void` - устанавливает данные о покупке
- `getClientInfo(): TClientInfo` - возвращает контактные данные клиента
- `setClientInfo(data: TClientInfo): void` - устанавливает контактные данные клиента
- `checkPurchaseValidation(data: Record<keyof TPurchaseInfo, string>): boolean` - проверяет объект с данными о покупке на валидность
- `checkClientValidation(data: Record<keyof TClientInfo, string>): boolean` - проверяет объект с данными клиента на валидность
- а также сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемента) переданных в них данных.

#### Класс Modal
Реализует модальное окно. Также предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели для закрытия модального окна кликом по оверлею или кнопке закрытия.
- `constructor(selector: string, events: IEvents)` - Конструктор принимает селектор, по которому в разметке страницы будет найдено модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- `modal: HTMLElement` - элемент модального окна
- `content: HTMLElement` - контент модального окна, устанавливается через сеттер
- `events: IEvents` - брокер событий

#### Класс Card
Отвечает за отображение карточки товара, задавая в карточке данные категории, названия, изображения и цены. Класс используется для отображения карточек на странице сайта. В конструктор класса передаётся DOM-элемент темплейта.\
Поля класса содержат элементы разметки карточки и id товара.
- `constructor(template: HTMLTemplateElement, events: IEvents)` - Конструктор принимает темплейт и экземпляр класса `EventEmitter` для возможности инициации событий.

Методы:
- `setValid(isValid: boolean): void` - изменяет активность кнопки покупки
- `setData(data: IProduct): void` - заполняет элементы разметки карточки переданными данными
- `render(): HTMLElement` - метод возвращает полностью заполненную карточку с установленными слушателями
- геттер id возвращает id товара.

#### Класс Cart
Отвечает за отображение корзины и иконки корзины.
- `constructor(template: HTMLTemplateElement, events: IEvents, cartIconSelector: string | null)` - Конструктор принимает темплейт, экземпляр класса `EventEmitter` для возможности инициации событий и опциональный селектор иконки корзины на главной странице.

Поля класса:
- `content: NodeListOf<HTMLElement>` - содержимое корзины, устанавливается через сеттер
- `itemsAmount: number` - количество товаров в корзине, отображаемое на главной странице, устанавливается через сеттер
- элементы разметки корзины и иконки корзины

Методы:
- `render(): HTMLElement` - возвращает элемент корзины с установленными слушателями
- `setValid(isValid: boolean): void` - изменяет активность кнопки оформления
- `addItem(item: HTMLElement): void` - добавляет элемент в корзину

#### Класс Form
Отвечает за отображение форм.
- `constructor(template: HTMLTemplateElement, events: IEvents)` - Конструктор принимает темплейт и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `errors` - сеттер текста ошибок формы
- элементы разметки формы

Методы:
- `setValid(isValid: boolean): void` - изменяет активность кнопки сабмита
- `getData(): Object` - возвращает данные, полученные из формы в виде объекта
- `clear(): void` - очистка всей формы
- `render(): HTMLElement` - возвращает элемент формы с установленными слушателями

#### Класс OrderResult
Отвечает за отображение результата заказа.
- `constructor(template: HTMLTemplateElement, events: IEvents)` - Конструктор принимает темплейт и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `totalPrice: number` - сеттер стоимости заказа
- элементы разметки блока

Методы:
- `render(): HTMLElement` - возвращает элемент разметки с установленными слушателями

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. Предоставляет метод `addCard(cardElement: HTMLElement): void` для добавления карточек на страницу и сеттер `container` для полного обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `cards:changed` - изменение массива карточек
- `card:selected` - выбор открываемой в модальном окне карточки
- `card:selectedClear` - необходима очистка данных выбранной для показа в модальном окне карточки
- `cart:changed` - товары в корзине изменились

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:preview` - выбор открываемой в модальном окне карточки
- `cart:open` - открыть модальное окно корзины
- `purchase:open` - открыть модальное окно с формой данных о заказе
- `contacts:open` - открыть модальное окно с формой контактных данных
- `order-result:open` - открыть модальное окно со статусом заказа
- `purchase:input` - изменение данных в форме с информацией о заказе
- `contacts:input` - изменение данных в форме контактной информации
- `purchase:submit` - отправка формы с информацией о заказе
- `contacts:submit` - отправка формы контактной информации
- `purchase:validation` - событие, сообщающее о необходимости валидации формы с информацией о заказе
- `contacts:validation` - событие, сообщающее о необходимости валидации формы контактной информации
- `card:add` - добавить товар в корзину
- `card:remove` - удалить товар из корзины